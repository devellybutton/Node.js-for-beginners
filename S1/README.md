# 섹션1. 노드의 정의와 특성

> - [노드의 정의](#노드의-정의)
> - [노드의 구성요소](#노드의-구성요소)
> - [노드의 특성](#노드의-특성)
> - [서버로서의 노드](#서버로서의-노드)

---

## 노드의 정의

### 1) Node.js 개발 배경

- 브라우저와의 관계:
  - 자바스크립트는 본래 HTML 문서 내에서 실행되는 스크립트로, 브라우저에 종속적이었다.
  - 브라우저에서 자바스크립트를 실행하려면 HTML 파일 내에 `<script> ` 태그를 사용해야 했다.
- Node.js의 등장:
  - Node.js는 브라우저 외부에서도 자바스크립트를 실행할 수 있게 만든 자바스크립트 런타임이다.
  - Node.js를 설치하고 자바스크립트 파일을 작성한 후, node <파일명>을 실행하면, V8 자바스크립트 엔진이 코드를 해석하고 실행한다.
- 기술 발전 배경:
  - Node.js 이전에도 자바스크립트를 서버에서 실행하려는 시도가 있었다. 예를 들어 Rhino 같은 자바스크립트 엔진이 있었지만 성능이 부족했다.
  - Node.js의 핵심 기술은 크롬의 V8 자바스크립트 엔진인데, V8은 자바스크립트를 매우 빠르게 실행할 수 있는 능력을 가지고 있어, 속도 문제를 해결했다.
  - 덕분에 자바스크립트는 서버, 앱, 게임 등 다양한 분야에서 사용될 수 있는 가능성을 열었다.
- 논블로킹 / 비동기 API의 필요성:
  - Node.js 이전에는 논블로킹/비동기 API를 서버 환경에 구현하는 것이 매우 어려웠다.
  - 서버에서 동시 실행되는 스레드와 공유 자원을 관리하려면 프로그래머가 직접 이를 만들고 관리해야 했기 때문에 많은 복잡성과 실수가 있었다.
  - 이를 라이언 달은 <b>"논블로킹 감옥"</b>이라고 표현하며, 비동기 처리 환경의 필요성을 강조했다.
- 이벤트 기반 모델:
  - 라이언 달은 비동기 환경을 쉽게 다룰 수 있는 방법으로 이벤트 기반(Event-Driven) 비동기 환경을 설계했다.
  - 이를 통해 Node.js는 논블로킹 I/O를 자연스럽게 처리할 수 있으며, 서버가 동시 요청을 효율적으로 처리할 수 있게 되었다.
- Node.js 소개:
  - 라이언 달은 2009년 JSConf EU 2009에서 Node.js라는 자바스크립트 런타임 환경을 처음 소개하며, 서버 환경에서도 자바스크립트를 사용할 수 있다는 새로운 패러다임을 제시했다.
- 자바스크립트의 위상 변화:
  - Node.js의 등장으로 자바스크립트는 웹 개발을 넘어 다양한 용도로 사용될 수 있는 언어로 자리잡게 되었다.
  - 개발자 중 웹 개발자가 가장 많기 때문에, 자바스크립트의 중요성과 역할이 더욱 부각되었다.
- 공식 설명:
  - Node.js는 크롬 V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임

### 2) Node.js는 서버가 아닌가?

- Node.js는 서버가 아니다:
    - Node.js는 자바스크립트를 실행할 수 있는 런타임이다.
    - 서버 역할도 할 수 있지만 그 자체로는 서버가 아니다.

- 서버 역할 수행:
    - Node.js는 서버 역할을 할 수 있는 자바스크립트 런타임으로, 자바스크립트로 서버를 작성하고 실행할 수 있다.
    - 이를 위해 http, https, http2 모듈 등을 제공하여 웹 서버를 쉽게 구현할 수 있다.

- 런타임:
    - <b>런타임</b>: 특정 언어로 작성된 프로그램을 실행할 수 있는 환경을 제공하는 가상 머신 또는 엔진.
    - <b>Node.js</b>: 자바스크립트 프로그램을 실행할 수 있는 자바스크립트 런타임, 크롬의 V8 자바스크립트 엔진 사용.
    - <b>웹 브라우저</b>: 크롬, 엣지, 사파리 등도 자바스크립트를 실행할 수 있는 자바스크립트 런타임.
    - <b>Node.js 이전의 시도</b>: 자바스크립트를 서버에서 실행하려는 시도는 있었지만, 엔진 속도 문제로 성능에 한계가 있었음. Node.js는 V8 엔진 덕분에 이 문제를 해결.

- 개념 정리:
    - 자바스크립트: 언어
    - V8 자바스크립트 엔진: 자바스크립트를 실행하는 엔진
    - Node.js: 자바스크립트를 실행하는 런타임 (서버 역할을 포함)

- 비교 (자바와 유사한 개념):
    - 자바 → 언어
    - JRE (Java Runtime Environment) → 런타임
    - JDK (Java Development Kit) → Node.js와 유사한 역할

- Deno:
    - TypeScript를 기본으로 지원하는 새로운 자바스크립트 런타임
    - Node.js의 창시자가 만들었음.

---

## 노드의 구성요소

### 1) Node.js 구성요소
![image](https://github.com/user-attachments/assets/ebfd611f-e96a-4e70-863c-b18051c44bb6)
출처 : Node.js 백엔드 개발자되기 
| 계층                        | 설명                                                              |
|---------------------------|-----------------------------------------------------------------|
| **사용자 코드 (자바스크립트)** | Node.js의 API를 호출하는 자바스크립트 코드                                 |
| **Node.js API**              | C++ 애드온을 호출하는 Node.js의 API                                    |
| **C++ 애드온 및 바인딩**      | V8 엔진을 사용하여 자바스크립트를 해석하고 최적화                           |
| **V8 엔진**                  | 자바스크립트 코드를 실행하고, JIT 컴파일 및 최적화 수행                      |
| **libuv**                    | 운영체제 API를 추상화하여 비동기 I/O 및 이벤트 루프 처리                     |

### 2) Node.js 구성요소
```
[JavaScript 코드]
        ↓
[Parser (구문 분석)]
        ↓
[Interpreter (Ignition)]
        ↓
[Compiler (TurboFan)]
        ↓
[Machine Code]
```
- 주요 프로세스:
    1. 파싱 단계
        - JavaScript 코드 → AST(추상 구문 트리) 변환
        - 문법 오류 검사
    2. 실행 단계
        - Ignition(인터프리터): 바이트코드 생성 & 실행
        - TurboFan(컴파일러): 자주 사용되는 코드 최적화
- 메모리 관리:
    - Heap: 객체, 문자열 등 저장
    - Stack: 실행 컨텍스트, 원시값 저장

---

## 노드의 특성
> 1. 이벤트 기반 (Event Driven)
> 2. 논블로킹 I/O (Non blocking I/O)
> 3. 싱글스레드 (Single Thread)


### 1. 이벤트 기반
- 이벤트 기반 아키텍처는 프로그램의 흐름이 이벤트의 발생과 이에 대한 응답으로 결정되는 프로그래밍 패러다임
- 이벤트가 발생할 떄 미리 지정해둔 작업을 수행하는 방식
- 이벤트의 예 : 클릭, 네트워크 요청, 타이머 등

#### 1) 문제
- 싱글 스레드 서버는 한 번에 하나의 요청만 처리할 수 있다.
- 예를 들어, 0.1초가 걸리는 요청 100개가 동시에 들어오면 마지막 요청자는 10초를 기다려야 한다.

#### 2) 해결 방법
- **이벤트 기반 아키텍처**를 적용하여, 요청을 한 번에 처리하지 않고 **I/O 작업을 비동기적으로 처리**하여 효율성을 극대화한다.
- **콜 스택**에 작업을 쌓고, **이벤트 루프**가 이를 비동기적으로 처리하여 빠르게 응답한다.

#### 3) 비유
- 커피숍에서 **카운터**는 음료가 나오기를 기다리지 않고, **다음 주문**을 받는다. 
- 음료가 준비되면 고객에게 알림을 주고, 고객은 알림을 받은 후 음료를 받는다.

#### 4) Node.js 동작 흐름
![image](https://github.com/user-attachments/assets/e56d562c-4f86-4a30-80ab-a250d1a646b9)
1. 자바스크립트 코드는 **V8 콜 스택**에 쌓인다.
2. I/O 처리가 필요한 작업은 **이벤트 루프**로 전달됩니다.
3. 루프를 실행하고, **운영체제** 또는 **스레드 워커**가 I/O 작업을 처리한다.
4. 작업이 완료되면 **운영체제** 또는 **스레드 워커**가 결과를 **이벤트 루프**로 전달하고, 이벤트 루프는 결과를 **콜 스택**에 다시 추가하여 실행한다.

### 2. 논블로킹 I/O

#### 1) 동시 실행이 아니다
- Node.js에서는 **동시 실행**(parallel execution)은 실제로 존재하지 않는다.
- 대신 **비동기 논블로킹** 방식으로 여러 작업이 동시에 실행되는 것처럼 보이게 된다.
- **동시 실행**과 **비동기 논블로킹**은 다르며, 실제로는 **백그라운드에서 작업**이 처리되고, 메인 스레드는 다른 작업을 계속 진행한다.

#### 2) 동기(Synchronous) vs 비동기(Asynchronous)

- **동기(Synchronous)**:
  - 코드가 **순차적으로** 실행됩니다.
  - 이전 작업이 완료될 때까지 **다음 작업**이 실행되지 않음.
  - **블로킹** 방식으로 처리됨.
  
- **비동기(Asynchronous)**:
  - 코드가 **순차적으로 실행되지 않고** **즉시 다음 작업**을 실행한다.
  - **논블로킹** 방식으로 처리되어, 시간이 오래 걸리는 작업은 **백그라운드**로 넘기고, 메인 스레드는 다른 작업을 계속 진행한다.

#### 3) 블로킹(Blocking) vs 논블로킹(Non-Blocking)

- **블로킹(Blocking)**:
  - 이전 작업이 끝날 때까지 **다음 작업**이 실행되지 않음.
  - 코드가 **순차적으로** 실행됨.
  
- **논블로킹(Non-Blocking)**:
  - 이전 작업이 끝나지 않아도 **다음 작업**을 즉시 실행.
  - **백그라운드에서 작업**이 처리되며, 메인 스레드는 다른 작업을 계속 진행함.

- 비동기 = 논블로킹인가?
  - 비동기는 반드시 논블로킹일 필요는 없다. 예를 들어, 비동기 작업을 블로킹 방식으로 처리할 수도 있다. 하지만 일반적으로 비동기 작업은 논블로킹 방식으로 처리된다.

#### 4) Node.js의 I/O 처리

- **논블로킹 I/O**:
  - Node.js는 **비동기 논블로킹 I/O** 방식을 사용하여 **시간이 오래 걸리는 작업**(파일 시스템 접근, 네트워크 요청 등)을 **백그라운드**에서 처리한다.
  - **I/O 작업이 많을 때** Node.js의 **효율성**을 극대화할 수 있다.

- **일부 작업은 백그라운드에서 병렬로 처리**:
  - 예: **파일 시스템 접근**, **네트워크 요청**, **압축**, **암호화** 등의 작업은 **병렬로 처리**된다.
  
- **나머지 작업은 블로킹 방식으로 처리**:
  - I/O와 관련된 작업 외에는 **블로킹 방식**으로 처리된다.
  - 일반적인 계산이나 처리 작업은 순차적으로 실행된다.

#### 5) 실행 컨텍스트와 이벤트 루프

- **실행 컨텍스트**: Node.js가 코드 실행을 위해 사용하는 **환경**
- **이벤트 루프**: 비동기 작업을 처리하는 **핵심**으로, Node.js에서 **이벤트**를 처리하고 **비동기 작업**을 관리한다.

#### 요약

- **비동기 논블로킹**: Node.js는 비동기 논블로킹 I/O 방식을 사용하여 시간이 오래 걸리는 작업을 백그라운드에서 처리하고, 메인 스레드는 다른 작업을 계속 실행할 수 있게 한다.
- **동기**: 작업이 순차적으로 실행됩니다. 블로킹 방식으로 진행된다.
- **비동기**: 작업이 순차적으로 실행되지 않으며, 논블로킹 방식으로 진행된다.
- **블로킹**: 작업이 순차적으로 실행된다.
- **논블로킹**: 작업이 순차적으로 실행되지 않으며, 백그라운드에서 병렬로 처리될 수 있다.

### 3. 싱글스레드

#### 1) 프로세스와 스레드
- 프로세스 : 운영체제에서 할당하는 작업의 단위, 프로세스 간 자원 공유 안함
- 스레드 : 프로세스 내에서 실행되는 작업의 단위, 부모 프로세스 자원 공유

#### 2) Node.js 정말 스레드가 1개인가?
- 메인 스레드는 하나지만, 실제 작업을 처리하는 스레드는 여러 개가 존재하여 비동기 I/O 작업을 효율적으로 처리함.
    - 메인 스레드: Node.js의 자바스크립트 코드가 실행되는 단일 스레드
    - 백그라운드 스레드: libuv에 의해 관리되는 여러 스레드(기본 4개)로, 비동기 I/O 작업을 처리함.
    - 이벤트 루프: 메인 스레드에서 비동기 작업을 처리하고, 백그라운드 스레드로 작업을 위임하는 역할을 함.

---

## 서버로서의 노드

### 1) 서버와 클라이언트의 개념

- 서버
  - 네트워크를 통해 클라이언트에 정보나 서비스를 제공하는 컴퓨터 또는 프로그램
  - 예시: 웹사이트, 데이터베이스, 파일 서버 등
- 클라이언트
  - 서버에 요청을 보내는 주체
  - 예시: 브라우저, 데스크탑 프로그램, 모바일 앱 등
- 예시
  - 브라우저(클라이언트)가 길벗 웹사이트(서버)에 접속하여 정보를 요청
  - 핸드폰(클라이언트)을 통해 앱을 다운로드 받는 앱스코어(서버)

### 2) 노드 서버의 장단점

#### 장점

- <b>싱글스레드</b>: 기본적으로 하나의 스레드를 사용하여 컴퓨터 자원을 적게 사용
- <b>자바스크립트 사용</b>: 서버와 클라이언트 모두에서 자바스크립트를 사용하므로 언어 일관성 제공
- <b>비동기 I/O 처리</b>: I/O 작업이 많은 애플리케이션에서 비동기 처리 방식으로 성능을 최적화

#### 단점

- <b>CPU 집약적인 작업에서 성능 한계</b>: CPU 연산을 많이 요구하는 작업에서는 다른 언어나 플랫폼에 비해 성능이 떨어질 수 있음
- <b>싱글스레드</b>: 기본적으로 하나의 스레드를 사용하므로, 고도로 병렬적인 작업에 제한적일 수 있음

#### 성능 대안

- <b>성능이 중요한 경우</b>: Rust, Go 등은 노드보다 더 나은 성능을 제공할 수 있음
- <b>성능이 크게 중요하지 않은 경우</b>: 노드가 장점이 많음 (빠른 개발, 자바스크립트 통일성)

#### 개발 도구

- <b>VS Code</b>: 무료이지만 강력하고 유용한 편집기
- <b>웹스톰</b>: 유료이지만, 파일/폴더가 많을 때 특히 유용 (대형 프로젝트에서 더 효율적)
  `tools for native modules`: 노드를 사용할 때, native 모듈이 필요한 경우 꼭 체크해야 함
